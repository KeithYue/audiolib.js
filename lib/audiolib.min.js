this.audioLib=(function(r,e){var s=r.Float32Array||Array,b=this;function f(u){var v=new s(u);v.subarray=v.subarray||v.slice;return v}b.Float32Array=f;function o(A,v,x,B,z){this.attack=v||50;this.decay=x||50;this.sustain=B||1;this.release=z||50;this.value=0;var C=this,u=3,w=false,y=[function(){C.value+=1000/C.sampleRate/C.attack;if(C.value>=1){u=1}},function(){C.value-=1000/C.sampleRate/C.decay*C.sustain;if(C.value<=C.sustain){u=2}},function(){C.value=C.sustain},function(){C.value=e.max(0,C.value-1000/C.sampleRate/C.release)}];this.generate=function(){y[u]();return this.value};this.triggerGate=function(D){w=D;u=w?0:3};this.sampleRate=A}function m(){var B=this,u=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function A(D,E){this.key=D;this.velocity=E;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(G,F){this.key=G;this.v=F;this.onKeyChange()};this.getFrequency=function(){return B.getFrequencyForKey(this.key)};B.voice.apply(this)}function x(E){var D;for(D=0;D<u.length;D++){if(u[D].key===E){u.splice(D--,1)}}}function C(D,E){x(D);u.push({key:D,velocity:E})}function z(){var D,F,E=[];if(B.legato===0){E=u.slice(0)}else{if(B.legato===1){for(D=0;D<u.length;D++){for(F=0;F<E.length;F++){if(F===u.length-1||(E[F-1].key>u[D].key&&E[F].key<u[D].key)){E.splice(F,0,u[D]);break}}}}else{if(B.legato===2){for(D=0;D<u.length;D++){for(F=0;F<E.length;F++){if(F===u.length-1||(E[F-1].key<u[D].key&&E[F].key>u[D].key)){E.splice(F,0,u[D]);break}}}}}}B.activeKeys=E.slice(-B.polyphony)}function v(){if(!B.voice){return}var E,F,D;if(B.polyphony===1&&B.activeKeys.length>0){E=B.activeKeys.length-1;if(B.voices.length===0){B.voices.push(new A(B.activeKeys[E].key,B.activeKeys[E].velocity))}else{B.voices[0].changeKey(B.activeKeys[E].key,B.activeKeys[E].velocity)}}else{for(F=0;F<B.activeKeys.length;F++){D=false;for(E=0;E<B.voices.length;E++){if(B.voices[E].key===B.activeKeys[F].key){D=true;break}}if(!D){B.voices.push(new A(B.activeKeys[E].key,B.activeKeys[E].velocity))}}}for(E=0;E<B.voices.length;E++){D=false;for(F=0;F<B.activeKeys.length;F++){if(B.voices[E].key===B.activeKeys[F].key){D=true;break}}if(!D){B.voices[E].noteOff();B.voices.splice(E--,1)}}}function w(E,F){var D=B.activeKeys.length;C(E,F);z();v();B.onNoteOn(E,F);if(B.retrigger===0||(D===0&&B.activeKeys.length>0)){B.onTrigger()}}function y(D,E){x(D,E);z();v();B.onNoteOff(D,E);if(B.activeKeys===0){B.onRelease()}}this.onMidi=function(D){switch(D.status){case 9:w(D.data1,D.data2/127);break;case 8:y(D.data1,D.data2/127);break;case 14:B.pitchBend=(D.data1*128+D.data2-8192)/8192;break}};this.getFrequencyForKey=function(D){return 440*e.pow(1.059,D-69)};this.getFrequency=function(){var E=[],D;for(D=0;D<B.activeKeys.length;D++){E.push(B.getFrequencyForKey(B.activeKeys[D].key))}if(E.length>2){return E[0]}return E};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(D){B.onMidi(D)}}function p(x,y,w,z){var v=this,u=0;v.sampleRate=x;v.stepLength=y||200;v.steps=w||[1,0];v.value=0;v.attack=z||0;v.generate=function(){var G=v.sampleRate/1000*v.stepLength,B=v.steps,D=G*B.length,F,A,E,C,H;if(++u===D){u=0}F=u/D*B.length;A=F%1;F=e.floor(F);E=(F||B.length)-1;C=B[F]-B[E];H=B[F];if(A<v.attack){H-=C-C/v.attack*A}v.value=H;return H};v.triggerGate=function(){u=0}}function l(B,u,y,v){var D=this,w=new f(u),x=u-1,z=y,A=0,C=0;this.volume=D.volume||1;D.sampleRate=B;D.pushSample=function(E){w[z++]=E;C=w[A++]*D.volume;if(z>=x){z=0}if(A>=x){A=0}return C};D.getMix=function(){return C}}function n(A,w,z,v){var C=this,x,y,B;C.delayTime=w||30;C.depth=z||3;C.freq=v||0.1;function u(){x=new f(C.sampleRate*0.1);y=0;var E,D=x.length;for(E=0;E<D;E++){x[E]=0}}C.sampleRate=A;C.osc=new g(A,v);C.calcCoeff=u;C.pushSample=function(E){if(++y>=x.length){y=0}x[y]=E;C.osc.generate();var D=C.delayTime+C.osc.getMix()*C.depth;D*=C.sampleRate/1000;D=y-e.floor(D);while(D<0){D+=x.length}B=x[D];return B};C.getMix=function(){return B};u()}function d(C,z,F){var I=this,x=(!C?44100:C)*2,A=new f(x),B=0,y=0,E=0,H=0,D=e.floor;function w(){y=x/I.samplerate/I.time*1000;E=I.time}function G(J,M,L){var K=M;while(K++!==L){if(K>=x){K=0}A[K]=J}}function v(J){A[B++]+=J;if(B>I.time/1000*I.samplerate){B=0}A[B]=A[B]*I.feedback}function u(K){var J=D(B);if(E!==I.time){w()}B+=y;if(B>=x){B-=x}G(K+A[D(B)]*I.feedback,J,D(B))}this.time=!z?1000:z;this.feedback=0;this.algorithm=0;this.samplerate=C;this.pushSample=function(J){if(this.algorithm===0){v(J)}else{u(J)}H=A[D(B)];return H};this.getMix=function(){return H}}function k(u){var y=new c(u,720.484),x=new c(u,723.431),w=new c(u,1),v=0;this.gain=4;this.master=1;this.sampleRate=u;this.filters=[y,x,w];this.pushSample=function(z){y.pushSample(z);v=y.getMix(1)*this.gain;v=e.atan(v)+v;if(v>0.4){v=0.4}else{if(v<-0.4){v=-0.4}}x.pushSample(v);w.pushSample(x.getMix(0));v=w.getMix(1)*this.master;return v};this.getMix=function(){return v}}(function(u,v){v.Capper=function(y,z){var x=this,w=0;x.sampleRate=y;x.cap=z||1;x.pushSample=function(A){w=A>x.cap?2*x.cap-A:A<-x.cap?-2*x.cap-A:A;return w};x.getMix=function(){return w}};v.Expo=function(x,y){var w=this;sample=0;w.sampleRate=x;w.param=y||0.8;w.pushSample=function(z){sample=(z<0?-e.pow(w.param*2,-z):e.pow(w.param*2,z))/10;return sample};w.getMix=function(){return sample}}}(this,b));function c(y,B,F,E){var H=this,C=[0,0,0,0],v,w,G,z,D=e.sin,x=e.min,A=e.pow;H.cutoff=!B?20000:B;H.resonance=!F?0.1:F;H.samplerate=y;H.type=E||0;function u(){v=2*D(e.PI*x(0.25,H.cutoff/(H.samplerate*2)));w=x(2*(1-A(H.resonance,0.25)),x(2,2/v-v*0.5))}H.pushSample=function(I){if(G!==H.cutoff||z!==H.resonance){u();G=H.cutoff;z=H.resonance}C[3]=I-w*C[2];C[0]=C[0]+v*C[2];C[1]=C[3]-C[0];C[2]=v*C[1]+C[2];C[3]=I-w*C[2];C[0]=C[0]+v*C[2];C[1]=C[3]-C[0];C[2]=v*C[1]+C[2];return C[H.type]};H.getMix=function(I){return C[I||H.type]}}function j(w,x,y){var u=this,v=[0,0];u.cutoff=!x?20000:x;u.resonance=!y?0:y;u.samplerate=w;u.pushSample=function(A){var z=u.cutoff*2/u.samplerate,B=u.resonance+u.resonance/(1-z);v[0]=v[0]+z*(A-v[0]+B*(v[0]-v[1]));v[1]=v[1]+z*(v[0]-v[1]);return v[1]};u.getMix=function(){return v[1]}}function q(z,B,E){var I=this,H=0,y=0,C=e.PI*2,G,x,u,D,F,A;I.cutoff=!B?20000:B;I.resonance=!E?1:E;I.samplerate=z;function v(){G=C*I.cutoff/I.samplerate;x=1-G/(2*(I.resonance+0.5/(1+G))+G-2);u=x*x;D=u+1-2*e.cos(G)*x}I.pushSample=function(w){if(F!==I.cutoff||A!==I.resonance){v();F=I.cutoff;A=I.resonance}H+=(w-y)*D;y+=H;H*=u;return y};I.getMix=function(){return y};v()}function g(x,A){var v=0,z=0,w=e.PI*2,u=new f(1),y;this.frequency=440;if(A){this.frequency=A}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=x;this.generate=function(){var E=this.frequency+0,D=this.pulseWidth,C,B=arguments.length;for(C=0;C<B;C++){E+=E*arguments[C]}v=(v+E/this.samplerate/2)%1;z=(v+this.phaseOffset)%1;z=z<D?z/D:(z-D)/(1-D)};this.getMix=function(){return y[this.waveShape]()};this.getPhase=function(){return z};this.reset=function(){v=0};this.setWavetable=function(B){u=B;return true};this.sine=function(){return e.sin(z*w)};this.triangle=function(){if(z<0.5){return 4*z-1}return 3-4*z};this.square=function(){return(z<0.5)?-1:1};this.sawtooth=function(){return 1-z*2};this.invSawtooth=function(){return z*2-1};this.pulse=function(){if(z<0.5){if(z<0.25){return z*8-1}else{return 1-(z-0.25)*8}}return -1};this.wavetable=function(){return u[e.floor(z*u.length)]};y=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}function h(w,u,z){var v=this,y=[],x;v.sampleRate=w;v.sample=u;v.pitch=z||440;v.delayStart=0;v.delayEnd=0;v.maxVoices=0;v.noteOn=function(F){var D=F/v.pitch,C=v.sampleRate,E=C*v.delayStart,A=v.sample.length-C*v.delayEnd,B={f:F,p:E,s:D,l:A};y.push(B);return B};v.generate=function(){var A,B;for(A=0;A<y.length;A++){B=y[A];B.p+=B.s;B.p>B.l&&y.splice(A--,1)&&B.onend&&B.onend()}};v.getMix=function(){var B=0,A;for(A=0;A<y.length;A++){B+=h.interpolate(v.sample,y[A].p)}return B}}h.interpolate=function(u,y){var x=e.floor(y),w=x+1,v=y-x;w=w<u.length?w:0;return u[x]*(1-v)+u[w]*v};h.resample=function(y,C,D,E,B){var w=E/C*B/D,x=y.length,A=e.ceil(x/w),v=new f(A),z,u;for(z=0,u=0;z<x;z+=w){v[u++]=h.interpolate(y,z)}return v};(function(B){function v(H){var J,I=H.length,K={};for(J=0;J<I;J++){K[H[J]]=true}return K}function u(H,I){return I?F(H&255)+u(H>>8,I-1):""}var E=v([256,512,1024,2048,4096,8192,16384]),w=v([48000,44100,22050]),F=String.fromCharCode;function C(N,J,L,K){var I=C.devices,H;for(H in I){if(I.hasOwnProperty(H)&&I[H].enabled){try{return new I[H](N,J,L,K)}catch(M){}}}throw"No audio device available."}function z(Q,I,J,V){I=I||44100;J=J||1;V=V||1;var O=V*8,L=J*V,T=I*L,N=Q.length,K=N*V,R=(e.pow(2,O)-1)/2,W=V===2?32760:R,M,X,S,U,Y="",P="";function H(Z){return u(e.floor(R+Z*W),V)}Y="RIFF"+u(36+K,4)+"WAVEfmt "+u(16,4)+u(1,2)+u(J,2)+u(I,4)+u(T,4)+u(L,2)+u(O,2)+"data"+u(K,4);for(X=0;X<N;X++){Y+=H(Q[X])}return Y}function A(H){this.boundTo=H;this.buffers=[];H.activeRecordings.push(this)}A.prototype={toWav:function(H){return z(this.join(),this.boundTo.sampleRate,this.boundTo.channelCount,H)},add:function(H){this.buffers.push(H)},clear:function(){this.buffers=[]},stop:function(){var H=this.boundTo.activeRecordings,I;for(I=0;I<H.length;I++){if(H[I]===this){H.splice(I--,1)}}},join:function(){var L=0,M=0,J=this.buffers,H,N,K,I=J.length;for(K=0;K<I;K++){L+=J[K].length}H=new f(L);for(K=0;K<I;K++){for(N=0;N<J[K].length;N++){H[M+N]=J[K][N]}M+=J[K].length}return H}};function D(H){this.type=H}D.prototype={record:function(){return new A(this)},recordData:function(J){var K=this.activeRecordings,I,H=K.length;for(I=0;I<H;I++){K[I].add(J)}},writeBuffers:function(M){var I=this.buffers,H=M.length,K,J,L,N;if(I){for(L=0;L<I.length;L++){K=I[L];J=K.length;for(N=0;N<H&&N<J;N++){M[N]+=K[N]}I[L]=K.subarray(N);L>=J&&I.splice(L--,1)}}},writeBuffer:function(I){var H=this.buffers=this.buffers||[];H.push(I);return H.length}};function G(K,M,I,P){P=w[P]?P:44100;I=E[I]?I:P/2;var Q=this,N=0,O=null,L=new Audio(),H;function J(){var T,S,R,U;if(O){T=L.mozWriteAudio(O);N+=T;if(T<O.length){O=O.subarray(T);return O}O=null}S=L.mozCurrentSampleOffset();R=Number(S+I*M-N)+0;if(R>0){U=new f(R);K&&K(U,Q.channelCount);Q.writeBuffers(U);Q.recordData(U);T=L.mozWriteAudio(U);if(T<U.length){O=U.subarray(T)}N+=T}}L.mozSetup(M,P);H=setInterval(J,20);this.kill=function(){clearInterval(H)};this.activeRecordings=[];this.sampleRate=P;this.channelCount=M;this.type="moz"}G.enabled=true;G.prototype=new D("moz");function y(M,N,H,O){O=w[O]?O:44100;H=E[H]?H:4096;var P=this,I=new (window.AudioContext||webkitAudioContext)(),L=I.createJavaScriptNode(H,0,N),K=I.createBufferSource();function J(X){var W=X.outputBuffer,U=W.numberOfChannels,S,Q,R=W.length,Y=W.size,T=new Array(U),V=new f(R*U);for(S=0;S<U;S++){T[S]=W.getChannelData(S)}M&&M(V,U);P.writeBuffers(V);P.recordData(V);for(S=0;S<R;S++){for(Q=0;Q<U;Q++){T[Q][S]=V[S*U+Q]}}}L.onaudioprocess=J;K.connect(L);L.connect(I.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=I.sampleRate;this.channelCount=N;this.type="webkit"}y.enabled=true;y.prototype=new D("webkit");function x(N,I,L,K){K=w[K]?K:44100;L=E[L]?bufferSize:8192;var H=this,M;function J(){var O=new f(L*I);N&&N(O,H.channelCount);H.writeBuffers(O);H.recordData(O)}this.kill=function(){clearInterval(M)};this.activeRecordings=[];setInterval(J,L/K*1000);this.sampleRate=K;this.channelCount=I;this.type="dummy"}x.enabled=true;x.prototype=new D("dummy");C.arrayToWav=z;C.integerToString=u;C.deviceClass=D;C.propertyEnum=v;C.devices={moz:G,webkit:y,dummy:x};B.AudioDevice=C}(this));this.AudioDevice.createScheduled=function(x){var y=[],w=0,u;function v(D,B){var z=D.length/B,G=u.chunkSize,A=G*B,F,C,E;w=+new Date;for(C=0;C<z;C+=G){for(F=0;F<y.length;F++){y[F].t-=G;if(y[F].t<=0){y[F].f.apply(y[F].x,y[F].a);y.splice(F--,1)}}E=C*A;x(D.subarray(E,E+A),B)}}u=this.apply(this,[v].concat(Array.prototype.splice.call(arguments,1)));u.schedule=function(B,A,z){y.push({f:B,x:A,a:z,t:((new Date-w)*0.001*this.sampleRate)})};u.chunkSize=1;return u};(function(B,v){var C=v.sin,G=v.cos,F=v.sqrt,z=v.floor,A=v.pow,u=v.ln2,y=v.PI,x=y*2;function w(I,H,J){I.sampleRate=H;I.bufferSize=J;I.bandWidth=0.5*J*H*0.5;I.spectrum=new f(J*0.5);I.real=new f(J);I.imag=new f(J);I.peakBand=I.peak=0;I.getBandFrequency=function(K){return this.bandwidth*K+this.bandwidth*0.5};I.calculateSpectrum=function(){var V=this,K=V.spectrum,S=V.real,M=V.imag,U=0.5*V.bufferSize,L=F,R=J*0.5,Q,T,P,O;for(O=0;O<R;O++){Q=S[O];T=M[O];P=U*L(Q*Q+T*T);if(P>V.peak){V.peakBand=O;V.peak=P}}}}function E(I,H,J){return new E[I](H,J)}function D(I,O){var H=this,M=O*O*0.5,K=new f(M),L=new f(M),J;w(H,I,O);for(J=0;J<M;J++){K[J]=C(J*x/O);L[J]=G(J*x/O)}H.forward=function(T){var Y=this,W=Y.real,P=Y.imag,V=Y.bufferSize*0.5,R=T.length,U,X,S,Q,Z;for(S=0;S<V;S++){U=X=0;for(Q=0;Q<R;Q++){U+=L[Z=S*Q]*T[Q];X+=K[Z]*T[Q]}W[S]=U;P[S]=X}return Y.calculateSpectrum()}}B.FourierTransform=E;E.DFT=D}(this,e));b.ADSREnvelope=o;b.MidiEventTracker=m;b.StepSequencer=p;b.AllPassFilter=l;b.Chorus=n;b.Delay=d;b.Distortion=k;b.IIRFilter=c;b.LowPassFilter=j;b.LP12Filter=q;b.Oscillator=g;b.Sampler=h;function t(){var u=Array.prototype.splice.call(arguments,0),v=u.prototype=t.prototype;for(i in v){if(v.hasOwnProperty(i)){u[i]=v[i]}}return u}(function(u){t.prototype=u;u.pushSample=function(v){var w=this,y,x;for(x=0;x<w.length;x++){y=w[x].mix;v=w[x].pushSample(v)*y+v*(1-y)}return v}}({}));function a(){}a.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return t.apply(0,[this].concat(Array.prototype.splice.call(arguments,0)))}};(function(y,w,u,v,x){u=b.effects={};for(w=0;w<y.length;w++){v=y[w];u[v]=b[v];x=u[v].prototype=new a();x.name=x.fxid=v}}(["AllPassFilter","Chorus","Delay","Distortion","IIRFilter","LowPassFilter","LP12Filter"]));b.EffectChain=t;b.EffectClass=a;b.version="0.4.2";return b}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);