this.audioLib=(function(b,c){var l=b.Float32Array||Array,g=this;function n(p){var q=new l(p);q.subarray=q.subarray||q.slice;return q}function m(u,q,r,v,t){this.attack=q||50;this.decay=r||50;this.sustain=v||1;this.release=t||50;this.value=0;var x=this,p=3,s=false,w=[function(){x.value+=1000/x.sampleRate/x.attack;if(x.value>=1){p=1}},function(){x.value-=1000/x.sampleRate/x.decay*x.sustain;if(x.value<=x.sustain){p=2}},function(){x.value=x.sustain},function(){x.value=c.max(0,x.value-1000/x.sampleRate/x.release)}];this.generate=function(){w[p]();return this.value};this.triggerGate=function(y){s=y;p=s?0:3};this.sampleRate=u}function f(){var x=this,u=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function v(y,z){this.key=y;this.velocity=z;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(B,A){this.key=B;this.v=A;this.onKeyChange()};this.getFrequency=function(){return x.getFrequencyForKey(this.key)};x.voice.apply(this)}function s(z){var y;for(y=0;y<u.length;y++){if(u[y].key===z){u.splice(y--,1)}}}function w(y,z){s(y);u.push({key:y,velocity:z})}function q(){var y,A,z=[];if(x.legato===0){z=u.slice(0)}else{if(x.legato===1){for(y=0;y<u.length;y++){for(A=0;A<z.length;A++){if(A===u.length-1||(z[A-1].key>u[y].key&&z[A].key<u[y].key)){z.splice(A,0,u[y]);break}}}}else{if(x.legato===2){for(y=0;y<u.length;y++){for(A=0;A<z.length;A++){if(A===u.length-1||(z[A-1].key<u[y].key&&z[A].key>u[y].key)){z.splice(A,0,u[y]);break}}}}}}x.activeKeys=z.slice(-x.polyphony)}function p(){if(!x.voice){return}var y,A,z;if(x.polyphony===1&&x.activeKeys.length>0){y=x.activeKeys.length-1;if(x.voices.length===0){x.voices.push(new v(x.activeKeys[y].key,x.activeKeys[y].velocity))}else{x.voices[0].changeKey(x.activeKeys[y].key,x.activeKeys[y].velocity)}}else{for(A=0;A<x.activeKeys.length;A++){z=false;for(y=0;y<x.voices.length;y++){if(x.voices[y].key===x.activeKeys[A].key){z=true;break}}if(!z){x.voices.push(new v(x.activeKeys[y].key,x.activeKeys[y].velocity))}}}for(y=0;y<x.voices.length;y++){z=false;for(A=0;A<x.activeKeys.length;A++){if(x.voices[y].key===x.activeKeys[A].key){z=true;break}}if(!z){x.voices[y].noteOff();x.voices.splice(y--,1)}}}function t(z,A){var y=x.activeKeys.length;w(z,A);q();p();x.onNoteOn(z,A);if(x.retrigger===0||(y===0&&x.activeKeys.length>0)){x.onTrigger()}}function r(y,z){s(y,z);q();p();x.onNoteOff(y,z);if(x.activeKeys===0){x.onRelease()}}this.onMidi=function(y){switch(y.status){case 9:t(y.data1,y.data2/127);break;case 8:r(y.data1,y.data2/127);break;case 14:x.pitchBend=(y.data1*128+y.data2-8192)/8192;break}};this.getFrequencyForKey=function(y){return 440*c.pow(1.059,y-69)};this.getFrequency=function(){var z=[],y;for(y=0;y<x.activeKeys.length;y++){z.push(x.getFrequencyForKey(x.activeKeys[y].key))}if(z.length>2){return z[0]}return z};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(y){x.onMidi(y)}}function o(t,q,s,u){var r=this,p=0;r.sampleRate=t;r.stepLength=q||200;r.steps=s||[1,0];r.value=0;r.attack=u||0;r.generate=function(){var x=r.sampleRate/1000*r.stepLength,z=r.steps,y=x*z.length,B,v,w,A,C;if(++p===y){p=0}B=p/y*z.length;v=B%1;B=c.floor(B);w=(B||z.length)-1;A=z[B]-z[w];C=z[B];if(v<r.attack){C-=A-A/r.attack*v}r.value=C;return C};r.triggerGate=function(){p=0}}function h(w,t,s,p){var x=this,r,q,v;x.delayTime=t||30;x.depth=s||3;x.freq=p||0.1;function u(){r=new n(x.sampleRate*0.1);q=0;var z,y=r.length;for(z=0;z<y;z++){r[z]=0}}x.sampleRate=w;x.osc=new j(w,p);x.calcCoeff=u;x.pushSample=function(z){if(++q>=r.length){q=0}r[q]=z;x.osc.generate();var y=x.delayTime+x.osc.getMix()*x.depth;y*=x.sampleRate/1000;y=q-c.floor(y);while(y<0){y+=r.length}v=r[y];return v};x.getMix=function(){return v};u()}function e(z,v,t){var D=this,u=(!z?44100:z)*2,y=new n(u),x=0,w=0,s=0,C=0,A=c.floor;function B(){w=u/D.samplerate/D.time*1000;s=D.time}function q(F,H,G){var E=H;while(E++!==G){if(E>=u){E=0}y[E]=F}}function r(E){y[x++]+=E;if(x>D.time/1000*D.samplerate){x=0}y[x]=y[x]*D.feedback}function p(F){var E=A(x);if(s!==D.time){B()}x+=w;if(x>=u){x-=u}q(F+y[A(x)]*D.feedback,E,A(x))}this.time=!v?1000:v;this.feedback=0;this.algorithm=0;this.samplerate=z;this.pushSample=function(E){if(this.algorithm===0){r(E)}else{p(E)}C=y[A(x)];return C};this.getMix=function(){return C}}function a(p){var t=new d(p,720.484),s=new d(p,723.431),r=new d(p,1),q=0;this.gain=4;this.master=1;this.sampleRate=p;this.filters=[t,s,r];this.pushSample=function(u){t.pushSample(u);q=t.getMix(1)*this.gain;q=c.atan(q)+q;if(q>0.4){q=0.4}else{if(q<-0.4){q=-0.4}}s.pushSample(q);r.pushSample(s.getMix(0));q=r.getMix(1)*this.master;return q};this.getMix=function(){return q}}(function(q,p){p.Capper=function(s,t){var r=this,u=0;r.sampleRate=s;r.cap=t||1;r.pushSample=function(v){u=v>r.cap?2*r.cap-v:v<-r.cap?-2*r.cap-v:v;return u};r.getMix=function(){return u}};p.Expo=function(s,t){var r=this;sample=0;r.sampleRate=s;r.param=t||0.8;r.pushSample=function(u){sample=(u<0?-c.pow(r.param*2,-u):c.pow(r.param*2,u))/10;return sample};r.getMix=function(){return sample}}}(this,g));function d(u,q,B,z){var C=this,w=[0,0,0,0],p,s,A,r,y=c.sin,t=c.min,v=c.pow;C.cutoff=!q?20000:q;C.resonance=!B?0.1:B;C.samplerate=u;C.type=z||0;function x(){p=2*y(c.PI*t(0.25,C.cutoff/(C.samplerate*2)));s=t(2*(1-v(C.resonance,0.25)),t(2,2/p-p*0.5))}C.pushSample=function(D){if(A!==C.cutoff||r!==C.resonance){x();A=C.cutoff;r=C.resonance}w[3]=D-s*w[2];w[0]=w[0]+p*w[2];w[1]=w[3]-w[0];w[2]=p*w[1]+w[2];w[3]=D-s*w[2];w[0]=w[0]+p*w[2];w[1]=w[3]-w[0];w[2]=p*w[1]+w[2];return w[C.type]};C.getMix=function(D){return w[D||C.type]}}function k(r,s,t){var p=this,q=[0,0];p.cutoff=!s?20000:s;p.resonance=!t?0:t;p.samplerate=r;p.pushSample=function(v){var u=p.cutoff*2/p.samplerate,w=p.resonance+p.resonance/(1-u);q[0]=q[0]+u*(v-q[0]+w*(q[0]-q[1]));q[1]=q[1]+u*(q[0]-q[1]);return q[1]};p.getMix=function(){return q[1]}}function i(x,t,E){var F=this,C=0,v=0,z=c.PI*2,B,s,p,A,D,u;F.cutoff=!t?20000:t;F.resonance=!E?1:E;F.samplerate=x;function y(){B=z*F.cutoff/F.samplerate;s=1-B/(2*(F.resonance+0.5/(1+B))+B-2);p=s*s;A=p+1-2*c.cos(B)*s}F.pushSample=function(q){if(D!==F.cutoff||u!==F.resonance){y();D=F.cutoff;u=F.resonance}C+=(q-v)*A;v+=C;C*=p;return v};F.getMix=function(){return v};y()}function j(t,w){var r=0,v=0,s=c.PI*2,q=new n(1),u;this.frequency=440;if(w){this.frequency=w}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=t;this.generate=function(){var z=this.frequency+0,y=this.pulseWidth,x,p=arguments.length;for(x=0;x<p;x++){z+=z*arguments[x]}r=(r+z/this.samplerate/2)%1;v=(r+this.phaseOffset)%1;v=v<y?v/y:(v-y)/(1-y)};this.getMix=function(){return u[this.waveShape]()};this.getPhase=function(){return v};this.reset=function(){r=0};this.setWavetable=function(p){q=p;return true};this.sine=function(){return c.sin(v*s)};this.triangle=function(){if(v<0.5){return 4*v-1}return 3-4*v};this.square=function(){return(v<0.5)?-1:1};this.sawtooth=function(){return 1-v*2};this.invSawtooth=function(){return v*2-1};this.pulse=function(){if(v<0.5){if(v<0.25){return v*8-1}else{return 1-(v-0.25)*8}}return -1};this.wavetable=function(){return q[c.floor(v*q.length)]};u=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}(function(p){function v(C){var E,D=C.length,B={};for(E=0;E<D;E++){B[C[E]]=true}return B}var y=v([256,512,1024,2048,4096,8192,16384]),q=v([48000,44100,22050]),A=String.fromCharCode;function x(J,F,H,C){J=q[J]?J:44100;C=y[C]?bufferSize:J/2;var K=this,E=0,I=null,G=new Audio(),B;function D(){var L,O,N,M;if(I){L=G.mozWriteAudio(I);E+=L;if(L<I.length){I=I.subarray(L);return I}I=null}O=G.mozCurrentSampleOffset();N=Number(O+C*F-E)+0;if(N>0){M=new n(N);H(M);K.recordData(M);L=G.mozWriteAudio(M);if(L<M.length){I=M.subarray(L)}E+=L}}G.mozSetup(F,J);B=setInterval(D,20);this.kill=function(){clearInterval(B)};this.activeRecordings=[];this.sampleRate=J;this.channelCount=F;this.type="moz"}function t(I,F,G,C){I=q[I]?I:44100;C=y[C]?bufferSize:4096;var J=this,B=new (p.AudioContext||p.webkitAudioContext)(),E=B.createJavaScriptNode(C,0,F),H=B.createBufferSource();function D(R){var K=R.outputBuffer,N=K.numberOfChannels,P,M,O=K.length,S=K.size,Q=new Array(N),L=new n(O*N);for(P=0;P<N;P++){Q[P]=K.getChannelData(P)}G(L);J.recordData(L);for(P=0;P<O;P++){for(M=0;M<N;M++){Q[M][P]=L[P*N+M]}}}E.onaudioprocess=D;H.connect(E);E.connect(B.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=B.sampleRate;this.channelCount=F;this.type="webkit"}function u(E,F,G,D){E=q[E]?E:44100;D=y[D]?bufferSize:8192;var B=this,H;function C(){var I=new n(D*F);G(I);B.recordData(I)}this.kill=function(){clearInterval(H)};this.activeRecordings=[];setInterval(C,D/E*1000);this.sampleRate=E;this.channelCount=F;this.type="dummy"}function z(C,D,F,B){try{return new x(C,D,F,B)}catch(G){}try{return new t(C,D,F,B)}catch(E){}if(z.dummy){return new u(C,D,F,B)}throw"No audio device available."}function w(B,C){return C?A(B&255)+w(B>>8,C-1):""}function s(L,D,I,Q){D=D||44100;I=I||1;Q=Q||1;var J=Q*8,F=I*Q,R=D*F,G=L.length,E=G*Q,B=(c.pow(2,J)-1)/2,P=Q===2?32760:B,H,O,M,N,S="",K="";function C(T){return w(c.floor(B+T*P),Q)}S="RIFF"+w(36+E,4)+"WAVEfmt "+w(16,4)+w(1,2)+w(I,2)+w(D,4)+w(R,4)+w(F,2)+w(J,2)+"data"+w(E,4);for(O=0;O<G;O++){S+=C(L[O])}return S}function r(B){this.boundTo=B;this.buffers=[];B.activeRecordings.push(this)}r.prototype={toWav:function(B){return s(this.join(),this.boundTo.sampleRate,this.boundTo.channelCount,B)},add:function(B){this.buffers.push(B)},clear:function(){this.buffers=[]},stop:function(){var B=this.boundTo.activeRecordings,C;for(C=0;C<B.length;C++){if(B[C]===this){B.splice(C--,1)}}},join:function(){var F=0,G=0,D=this.buffers,B,H,E,C=D.length;for(E=0;E<C;E++){F+=D[E].length}B=new n(F);for(E=0;E<C;E++){for(H=0;H<D[E].length;H++){B[G+H]=D[E][H]}G+=D[E].length}return B}};x.prototype=t.prototype=u.prototype={record:function(){return new r(this)},recordData:function(C){var E=this.activeRecordings,D,B=E.length;for(D=0;D<B;D++){E[D].add(C)}}};z.dummy=false;z.arrayToWav=s;z.integerToString=w;z.createDummy=function(C,B,E,D){return new u(C,B,E,D)};p.AudioDevice=z}(this));(function(q,r){var x=r.sin,B=r.cos,A=r.sqrt,v=r.floor,w=r.pow,p=r.ln2,u=r.PI,t=u*2;function s(D,C,E){D.sampleRate=C;D.bufferSize=E;D.bandWidth=0.5*E*C*0.5;D.spectrum=new n(E*0.5);D.real=new n(E);D.imag=new n(E);D.peakBand=D.peak=0;D.getBandFrequency=function(F){return this.bandwidth*F+this.bandwidth*0.5};D.calculateSpectrum=function(){var Q=this,L=Q.spectrum,M=Q.real,F=Q.imag,P=0.5*Q.bufferSize,G=A,K=E*0.5,J,O,I,H;for(H=0;H<K;H++){J=M[H];O=F[H];I=P*G(J*J+O*O);if(I>Q.peak){Q.peakBand=H;Q.peak=I}}}}function z(D,C,E){return new z[D](C,E)}function y(D,I){var C=this,G=I*I*0.5,F=new n(G),H=new n(G),E;s(C,D,I);for(E=0;E<G;E++){F[E]=x(E*t/I);H[E]=B(E*t/I)}C.forward=function(O){var T=this,R=T.real,J=T.imag,Q=T.bufferSize*0.5,L=O.length,P,S,M,K,U;for(M=0;M<Q;M++){P=S=0;for(K=0;K<L;K++){P+=H[U=M*K]*O[K];S+=F[U]*O[K]}R[M]=P;J[M]=S}return T.calculateSpectrum()}}q.FourierTransform=z;z.DFT=y}(this,c));g.ADSREnvelope=m;g.MidiEventTracker=f;g.StepSequencer=o;g.Chorus=h;g.Delay=e;g.Distortion=a;g.IIRFilter=d;g.LowPassFilter=k;g.LP12Filter=i;g.Oscillator=j;return g}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);