this.audioLib=(function(c,d){var m=c.Float32Array||Array,h=this;function o(q){var r=new m(q);r.subarray=r.subarray||r.slice;return r}function n(v,r,s,w,u){this.attack=r||50;this.decay=s||50;this.sustain=w||1;this.release=u||50;this.value=0;var y=this,q=3,t=false,x=[function(){y.value+=1000/y.sampleRate/y.attack;if(y.value>=1){q=1}},function(){y.value-=1000/y.sampleRate/y.decay*y.sustain;if(y.value<=y.sustain){q=2}},function(){y.value=y.sustain},function(){y.value=d.max(0,y.value-1000/y.sampleRate/y.release)}];this.generate=function(){x[q]();return this.value};this.triggerGate=function(z){t=z;q=t?0:3};this.sampleRate=v}function g(){var y=this,v=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function w(z,A){this.key=z;this.velocity=A;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(C,B){this.key=C;this.v=B;this.onKeyChange()};this.getFrequency=function(){return y.getFrequencyForKey(this.key)};y.voice.apply(this)}function t(A){var z;for(z=0;z<v.length;z++){if(v[z].key===A){v.splice(z--,1)}}}function x(z,A){t(z);v.push({key:z,velocity:A})}function r(){var z,B,A=[];if(y.legato===0){A=v.slice(0)}else{if(y.legato===1){for(z=0;z<v.length;z++){for(B=0;B<A.length;B++){if(B===v.length-1||(A[B-1].key>v[z].key&&A[B].key<v[z].key)){A.splice(B,0,v[z]);break}}}}else{if(y.legato===2){for(z=0;z<v.length;z++){for(B=0;B<A.length;B++){if(B===v.length-1||(A[B-1].key<v[z].key&&A[B].key>v[z].key)){A.splice(B,0,v[z]);break}}}}}}y.activeKeys=A.slice(-y.polyphony)}function q(){if(!y.voice){return}var z,B,A;if(y.polyphony===1&&y.activeKeys.length>0){z=y.activeKeys.length-1;if(y.voices.length===0){y.voices.push(new w(y.activeKeys[z].key,y.activeKeys[z].velocity))}else{y.voices[0].changeKey(y.activeKeys[z].key,y.activeKeys[z].velocity)}}else{for(B=0;B<y.activeKeys.length;B++){A=false;for(z=0;z<y.voices.length;z++){if(y.voices[z].key===y.activeKeys[B].key){A=true;break}}if(!A){y.voices.push(new w(y.activeKeys[z].key,y.activeKeys[z].velocity))}}}for(z=0;z<y.voices.length;z++){A=false;for(B=0;B<y.activeKeys.length;B++){if(y.voices[z].key===y.activeKeys[B].key){A=true;break}}if(!A){y.voices[z].noteOff();y.voices.splice(z--,1)}}}function u(A,B){var z=y.activeKeys.length;x(A,B);r();q();y.onNoteOn(A,B);if(y.retrigger===0||(z===0&&y.activeKeys.length>0)){y.onTrigger()}}function s(z,A){t(z,A);r();q();y.onNoteOff(z,A);if(y.activeKeys===0){y.onRelease()}}this.onMidi=function(z){switch(z.status){case 9:u(z.data1,z.data2/127);break;case 8:s(z.data1,z.data2/127);break;case 14:y.pitchBend=(z.data1*128+z.data2-8192)/8192;break}};this.getFrequencyForKey=function(z){return 440*d.pow(1.059,z-69)};this.getFrequency=function(){var A=[],z;for(z=0;z<y.activeKeys.length;z++){A.push(y.getFrequencyForKey(y.activeKeys[z].key))}if(A.length>2){return A[0]}return A};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(z){y.onMidi(z)}}function p(u,r,t,v){var s=this,q=0;s.sampleRate=u;s.stepLength=r||200;s.steps=t||[1,0];s.value=0;s.attack=v||0;s.generate=function(){var y=s.sampleRate/1000*s.stepLength,A=s.steps,z=y*A.length,C,w,x,B,D;if(++q===z){q=0}C=q/z*A.length;w=C%1;C=d.floor(C);x=(C||A.length)-1;B=A[C]-A[x];D=A[C];if(w<s.attack){D-=B-B/s.attack*w}s.value=D;return D};s.triggerGate=function(){q=0}}function b(y,q,t,u){var z=this,s=new o(q),r=q-1,w=t,x=0,v=0;this.volume=z.volume||1;z.sampleRate=y;z.pushSample=function(A){s[w++]=A;v=s[x++]*z.volume;if(w>=r){w=0}if(x>=r){x=0}return v};z.getMix=function(){return v}}function i(x,u,t,q){var y=this,s,r,w;y.delayTime=u||30;y.depth=t||3;y.freq=q||0.1;function v(){s=new o(y.sampleRate*0.1);r=0;var A,z=s.length;for(A=0;A<z;A++){s[A]=0}}y.sampleRate=x;y.osc=new k(x,q);y.calcCoeff=v;y.pushSample=function(A){if(++r>=s.length){r=0}s[r]=A;y.osc.generate();var z=y.delayTime+y.osc.getMix()*y.depth;z*=y.sampleRate/1000;z=r-d.floor(z);while(z<0){z+=s.length}w=s[z];return w};y.getMix=function(){return w};v()}function f(A,w,u){var E=this,v=(!A?44100:A)*2,z=new o(v),y=0,x=0,t=0,D=0,B=d.floor;function C(){x=v/E.samplerate/E.time*1000;t=E.time}function r(G,I,H){var F=I;while(F++!==H){if(F>=v){F=0}z[F]=G}}function s(F){z[y++]+=F;if(y>E.time/1000*E.samplerate){y=0}z[y]=z[y]*E.feedback}function q(G){var F=B(y);if(t!==E.time){C()}y+=x;if(y>=v){y-=v}r(G+z[B(y)]*E.feedback,F,B(y))}this.time=!w?1000:w;this.feedback=0;this.algorithm=0;this.samplerate=A;this.pushSample=function(F){if(this.algorithm===0){s(F)}else{q(F)}D=z[B(y)];return D};this.getMix=function(){return D}}function a(q){var u=new e(q,720.484),t=new e(q,723.431),s=new e(q,1),r=0;this.gain=4;this.master=1;this.sampleRate=q;this.filters=[u,t,s];this.pushSample=function(v){u.pushSample(v);r=u.getMix(1)*this.gain;r=d.atan(r)+r;if(r>0.4){r=0.4}else{if(r<-0.4){r=-0.4}}t.pushSample(r);s.pushSample(t.getMix(0));r=s.getMix(1)*this.master;return r};this.getMix=function(){return r}}(function(r,q){q.Capper=function(t,u){var s=this,v=0;s.sampleRate=t;s.cap=u||1;s.pushSample=function(w){v=w>s.cap?2*s.cap-w:w<-s.cap?-2*s.cap-w:w;return v};s.getMix=function(){return v}};q.Expo=function(t,u){var s=this;sample=0;s.sampleRate=t;s.param=u||0.8;s.pushSample=function(v){sample=(v<0?-d.pow(s.param*2,-v):d.pow(s.param*2,v))/10;return sample};s.getMix=function(){return sample}}}(this,h));function e(v,r,C,A){var D=this,x=[0,0,0,0],q,t,B,s,z=d.sin,u=d.min,w=d.pow;D.cutoff=!r?20000:r;D.resonance=!C?0.1:C;D.samplerate=v;D.type=A||0;function y(){q=2*z(d.PI*u(0.25,D.cutoff/(D.samplerate*2)));t=u(2*(1-w(D.resonance,0.25)),u(2,2/q-q*0.5))}D.pushSample=function(E){if(B!==D.cutoff||s!==D.resonance){y();B=D.cutoff;s=D.resonance}x[3]=E-t*x[2];x[0]=x[0]+q*x[2];x[1]=x[3]-x[0];x[2]=q*x[1]+x[2];x[3]=E-t*x[2];x[0]=x[0]+q*x[2];x[1]=x[3]-x[0];x[2]=q*x[1]+x[2];return x[D.type]};D.getMix=function(E){return x[E||D.type]}}function l(s,t,u){var q=this,r=[0,0];q.cutoff=!t?20000:t;q.resonance=!u?0:u;q.samplerate=s;q.pushSample=function(w){var v=q.cutoff*2/q.samplerate,x=q.resonance+q.resonance/(1-v);r[0]=r[0]+v*(w-r[0]+x*(r[0]-r[1]));r[1]=r[1]+v*(r[0]-r[1]);return r[1]};q.getMix=function(){return r[1]}}function j(y,u,F){var G=this,D=0,x=0,A=d.PI*2,C,t,s,B,E,v;G.cutoff=!u?20000:u;G.resonance=!F?1:F;G.samplerate=y;function z(){C=A*G.cutoff/G.samplerate;t=1-C/(2*(G.resonance+0.5/(1+C))+C-2);s=t*t;B=s+1-2*d.cos(C)*t}G.pushSample=function(q){if(E!==G.cutoff||v!==G.resonance){z();E=G.cutoff;v=G.resonance}D+=(q-x)*B;x+=D;D*=s;return x};G.getMix=function(){return x};z()}function k(t,w){var r=0,v=0,s=d.PI*2,q=new o(1),u;this.frequency=440;if(w){this.frequency=w}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=t;this.generate=function(){var A=this.frequency+0,z=this.pulseWidth,y,x=arguments.length;for(y=0;y<x;y++){A+=A*arguments[y]}r=(r+A/this.samplerate/2)%1;v=(r+this.phaseOffset)%1;v=v<z?v/z:(v-z)/(1-z)};this.getMix=function(){return u[this.waveShape]()};this.getPhase=function(){return v};this.reset=function(){r=0};this.setWavetable=function(x){q=x;return true};this.sine=function(){return d.sin(v*s)};this.triangle=function(){if(v<0.5){return 4*v-1}return 3-4*v};this.square=function(){return(v<0.5)?-1:1};this.sawtooth=function(){return 1-v*2};this.invSawtooth=function(){return v*2-1};this.pulse=function(){if(v<0.5){if(v<0.25){return v*8-1}else{return 1-(v-0.25)*8}}return -1};this.wavetable=function(){return q[d.floor(v*q.length)]};u=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}(function(q){function w(E){var G,F=E.length,D={};for(G=0;G<F;G++){D[E[G]]=true}return D}function x(D,E){return E?C(D&255)+x(D>>8,E-1):""}var A=w([256,512,1024,2048,4096,8192,16384]),r=w([48000,44100,22050]),C=String.fromCharCode;function B(I,H,G,F){var E=B.devices,D;for(D in E){if(E.hasOwnProperty(D)&&E[D].enabled){try{return new E[D](I,H,G,F)}catch(J){}}}throw"No audio device available."}function t(N,F,K,S){F=F||44100;K=K||1;S=S||1;var L=S*8,H=K*S,T=F*H,I=N.length,G=I*S,D=(d.pow(2,L)-1)/2,R=S===2?32760:D,J,Q,O,P,U="",M="";function E(V){return x(d.floor(D+V*R),S)}U="RIFF"+x(36+G,4)+"WAVEfmt "+x(16,4)+x(1,2)+x(K,2)+x(F,4)+x(T,4)+x(H,2)+x(L,2)+"data"+x(G,4);for(Q=0;Q<I;Q++){U+=E(N[Q])}return U}function s(D){this.boundTo=D;this.buffers=[];D.activeRecordings.push(this)}s.prototype={toWav:function(D){return t(this.join(),this.boundTo.sampleRate,this.boundTo.channelCount,D)},add:function(D){this.buffers.push(D)},clear:function(){this.buffers=[]},stop:function(){var D=this.boundTo.activeRecordings,E;for(E=0;E<D.length;E++){if(D[E]===this){D.splice(E--,1)}}},join:function(){var H=0,I=0,F=this.buffers,D,J,G,E=F.length;for(G=0;G<E;G++){H+=F[G].length}D=new o(H);for(G=0;G<E;G++){for(J=0;J<F[G].length;J++){D[I+J]=F[G][J]}I+=F[G].length}return D}};function z(D){this.type=D}z.prototype={record:function(){return new s(this)},recordData:function(E){var G=this.activeRecordings,F,D=G.length;for(F=0;F<D;F++){G[F].add(E)}}};function y(J,H,E,L){L=r[L]?L:44100;E=A[E]?E:L/2;var M=this,G=0,K=null,I=new Audio(),D;function F(){var N,Q,P,O;if(K){N=I.mozWriteAudio(K);G+=N;if(N<K.length){K=K.subarray(N);return K}K=null}Q=I.mozCurrentSampleOffset();P=Number(Q+E*H-G)+0;if(P>0){O=new o(P);J(O,M.channelCount);M.recordData(O);N=I.mozWriteAudio(O);if(N<O.length){K=O.subarray(N)}G+=N}}I.mozSetup(H,L);D=setInterval(F,20);this.kill=function(){clearInterval(D)};this.activeRecordings=[];this.sampleRate=L;this.channelCount=H;this.type="moz"}y.enabled=true;y.prototype=new z("moz");function v(I,H,E,K){K=r[K]?K:44100;E=A[E]?E:4096;var L=this,D=new (window.AudioContext||webkitAudioContext)(),G=D.createJavaScriptNode(E,0,H),J=D.createBufferSource();function F(T){var M=T.outputBuffer,P=M.numberOfChannels,R,O,Q=M.length,U=M.size,S=new Array(P),N=new o(Q*P);for(R=0;R<P;R++){S[R]=M.getChannelData(R)}I(N,P);L.recordData(N);for(R=0;R<Q;R++){for(O=0;O<P;O++){S[O][R]=N[R*P+O]}}}G.onaudioprocess=F;J.connect(G);G.connect(D.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=D.sampleRate;this.channelCount=H;this.type="webkit"}v.enabled=true;v.prototype=new z("webkit");function u(I,H,G,F){F=r[F]?F:44100;G=A[G]?bufferSize:8192;var D=this,J;function E(){var K=new o(G*H);I(K,D.channelCount);D.recordData(K)}this.kill=function(){clearInterval(J)};this.activeRecordings=[];setInterval(E,G/F*1000);this.sampleRate=F;this.channelCount=H;this.type="dummy"}u.enabled=true;u.prototype=new z("dummy");B.arrayToWav=t;B.integerToString=x;B.deviceClass=z;B.propertyEnum=w;B.devices={moz:y,webkit:v,dummy:u};q.AudioDevice=B}(this));this.AudioDevice.createScheduled=function(u){var t=[],q=0,r;function s(w,z){var v=w.length/z,C=r.chunkSize,y=C*z,B,x,A;q=+new Date;for(x=0;x<v;x+=C){for(B=0;B<t.length;B++){t[B].t-=C;if(t[B].t<=0){t[B].f.apply(t[B].x,t[B].a);t.splice(B--,1)}}A=x*y;u(w.subarray(A,A+y),z)}}r=this.apply(this,[s].concat(Array.prototype.splice.call(arguments,1)));r.schedule=function(x,w,v){t.push({f:x,x:w,a:v,t:((new Date-q)*0.001*this.sampleRate)})};r.chunkSize=1;return r};(function(r,s){var y=s.sin,C=s.cos,B=s.sqrt,w=s.floor,x=s.pow,q=s.ln2,v=s.PI,u=v*2;function t(E,D,F){E.sampleRate=D;E.bufferSize=F;E.bandWidth=0.5*F*D*0.5;E.spectrum=new o(F*0.5);E.real=new o(F);E.imag=new o(F);E.peakBand=E.peak=0;E.getBandFrequency=function(G){return this.bandwidth*G+this.bandwidth*0.5};E.calculateSpectrum=function(){var R=this,M=R.spectrum,O=R.real,G=R.imag,Q=0.5*R.bufferSize,H=B,L=F*0.5,K,P,J,I;for(I=0;I<L;I++){K=O[I];P=G[I];J=Q*H(K*K+P*P);if(J>R.peak){R.peakBand=I;R.peak=J}}}}function A(E,D,F){return new A[E](D,F)}function z(E,J){var D=this,H=J*J*0.5,G=new o(H),I=new o(H),F;t(D,E,J);for(F=0;F<H;F++){G[F]=y(F*u/J);I[F]=C(F*u/J)}D.forward=function(P){var U=this,S=U.real,K=U.imag,R=U.bufferSize*0.5,M=P.length,Q,T,O,L,V;for(O=0;O<R;O++){Q=T=0;for(L=0;L<M;L++){Q+=I[V=O*L]*P[L];T+=G[V]*P[L]}S[O]=Q;K[O]=T}return U.calculateSpectrum()}}r.FourierTransform=A;A.DFT=z}(this,d));h.ADSREnvelope=n;h.MidiEventTracker=g;h.StepSequencer=p;h.AllPassFilter=b;h.Chorus=i;h.Delay=f;h.Distortion=a;h.IIRFilter=e;h.LowPassFilter=l;h.LP12Filter=j;h.Oscillator=k;h.version="0.4.1";return h}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);