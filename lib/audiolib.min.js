this.audioLib=(function(q,h){var n=q.Float32Array||Array,e=this;function b(u){var v=new n(u);v.subarray=v.subarray||v.slice;return v}e.Float32Array=b;function s(z,v,w,A,y){this.attack=v||50;this.decay=w||50;this.sustain=A||1;this.release=y||50;this.value=0;var C=this,u=3,x=false,B=[function(){C.value+=1000/C.sampleRate/C.attack;if(C.value>=1){u=1}},function(){C.value-=1000/C.sampleRate/C.decay*C.sustain;if(C.value<=C.sustain){u=2}},function(){C.value=C.sustain},function(){C.value=h.max(0,C.value-1000/C.sampleRate/C.release)}];this.generate=function(){B[u]();return this.value};this.triggerGate=function(D){x=D;u=x?0:3};this.sampleRate=z}function t(){var C=this,z=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function A(D,E){this.key=D;this.velocity=E;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(G,F){this.key=G;this.v=F;this.onKeyChange()};this.getFrequency=function(){return C.getFrequencyForKey(this.key)};C.voice.apply(this)}function x(E){var D;for(D=0;D<z.length;D++){if(z[D].key===E){z.splice(D--,1)}}}function B(D,E){x(D);z.push({key:D,velocity:E})}function v(){var D,F,E=[];if(C.legato===0){E=z.slice(0)}else{if(C.legato===1){for(D=0;D<z.length;D++){for(F=0;F<E.length;F++){if(F===z.length-1||(E[F-1].key>z[D].key&&E[F].key<z[D].key)){E.splice(F,0,z[D]);break}}}}else{if(C.legato===2){for(D=0;D<z.length;D++){for(F=0;F<E.length;F++){if(F===z.length-1||(E[F-1].key<z[D].key&&E[F].key>z[D].key)){E.splice(F,0,z[D]);break}}}}}}C.activeKeys=E.slice(-C.polyphony)}function u(){if(!C.voice){return}var D,F,E;if(C.polyphony===1&&C.activeKeys.length>0){D=C.activeKeys.length-1;if(C.voices.length===0){C.voices.push(new A(C.activeKeys[D].key,C.activeKeys[D].velocity))}else{C.voices[0].changeKey(C.activeKeys[D].key,C.activeKeys[D].velocity)}}else{for(F=0;F<C.activeKeys.length;F++){E=false;for(D=0;D<C.voices.length;D++){if(C.voices[D].key===C.activeKeys[F].key){E=true;break}}if(!E){C.voices.push(new A(C.activeKeys[D].key,C.activeKeys[D].velocity))}}}for(D=0;D<C.voices.length;D++){E=false;for(F=0;F<C.activeKeys.length;F++){if(C.voices[D].key===C.activeKeys[F].key){E=true;break}}if(!E){C.voices[D].noteOff();C.voices.splice(D--,1)}}}function y(E,F){var D=C.activeKeys.length;B(E,F);v();u();C.onNoteOn(E,F);if(C.retrigger===0||(D===0&&C.activeKeys.length>0)){C.onTrigger()}}function w(D,E){x(D,E);v();u();C.onNoteOff(D,E);if(C.activeKeys===0){C.onRelease()}}this.onMidi=function(D){switch(D.status){case 9:y(D.data1,D.data2/127);break;case 8:w(D.data1,D.data2/127);break;case 14:C.pitchBend=(D.data1*128+D.data2-8192)/8192;break}};this.getFrequencyForKey=function(D){return 440*h.pow(1.059,D-69)};this.getFrequency=function(){var E=[],D;for(D=0;D<C.activeKeys.length;D++){E.push(C.getFrequencyForKey(C.activeKeys[D].key))}if(E.length>2){return E[0]}return E};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(D){C.onMidi(D)}}function r(y,v,x,z){var w=this,u=0;w.sampleRate=y;w.stepLength=v||200;w.steps=x||[1,0];w.value=0;w.attack=z||0;w.generate=function(){var C=w.sampleRate/1000*w.stepLength,E=w.steps,D=C*E.length,G,A,B,F,H;if(++u===D){u=0}G=u/D*E.length;A=G%1;G=h.floor(G);B=(G||E.length)-1;F=E[G]-E[B];H=E[G];if(A<w.attack){H-=F-F/w.attack*A}w.value=H;return H};w.triggerGate=function(){u=0}}function m(C,u,x,y){var D=this,w=new b(u),v=u-1,A=x,B=0,z=0;this.volume=D.volume||1;D.sampleRate=C;D.pushSample=function(E){w[A++]=E;z=w[B++]*D.volume;if(A>=v){A=0}if(B>=v){B=0}return z};D.getMix=function(){return z}}function p(B,y,x,u){var C=this,w,v,A;C.delayTime=y||30;C.depth=x||3;C.freq=u||0.1;function z(){w=new b(C.sampleRate*0.1);v=0;var E,D=w.length;for(E=0;E<D;E++){w[E]=0}}C.sampleRate=B;C.osc=new c(B,u);C.calcCoeff=z;C.pushSample=function(E){if(++v>=w.length){v=0}w[v]=E;C.osc.generate();var D=C.delayTime+C.osc.getMix()*C.depth;D*=C.sampleRate/1000;D=v-h.floor(D);while(D<0){D+=w.length}A=w[D];return A};C.getMix=function(){return A};z()}function f(E,A,y){var I=this,z=(!E?44100:E)*2,D=new b(z),C=0,B=0,x=0,H=0,F=h.floor;function G(){B=z/I.samplerate/I.time*1000;x=I.time}function v(K,M,L){var J=M;while(J++!==L){if(J>=z){J=0}D[J]=K}}function w(J){D[C++]+=J;if(C>I.time/1000*I.samplerate){C=0}D[C]=D[C]*I.feedback}function u(K){var J=F(C);if(x!==I.time){G()}C+=B;if(C>=z){C-=z}v(K+D[F(C)]*I.feedback,J,F(C))}this.time=!A?1000:A;this.feedback=0;this.algorithm=0;this.samplerate=E;this.pushSample=function(J){if(this.algorithm===0){w(J)}else{u(J)}H=D[F(C)];return H};this.getMix=function(){return H}}function k(u){var y=new g(u,720.484),x=new g(u,723.431),w=new g(u,1),v=0;this.gain=4;this.master=1;this.sampleRate=u;this.filters=[y,x,w];this.pushSample=function(z){y.pushSample(z);v=y.getMix(1)*this.gain;v=h.atan(v)+v;if(v>0.4){v=0.4}else{if(v<-0.4){v=-0.4}}x.pushSample(v);w.pushSample(x.getMix(0));v=w.getMix(1)*this.master;return v};this.getMix=function(){return v}}(function(v,u){u.Capper=function(x,y){var w=this,z=0;w.sampleRate=x;w.cap=y||1;w.pushSample=function(A){z=A>w.cap?2*w.cap-A:A<-w.cap?-2*w.cap-A:A;return z};w.getMix=function(){return z}};u.Expo=function(x,y){var w=this;sample=0;w.sampleRate=x;w.param=y||0.8;w.pushSample=function(z){sample=(z<0?-h.pow(w.param*2,-z):h.pow(w.param*2,z))/10;return sample};w.getMix=function(){return sample}}}(this,e));function g(z,v,G,E){var H=this,B=[0,0,0,0],u,x,F,w,D=h.sin,y=h.min,A=h.pow;H.cutoff=!v?20000:v;H.resonance=!G?0.1:G;H.samplerate=z;H.type=E||0;function C(){u=2*D(h.PI*y(0.25,H.cutoff/(H.samplerate*2)));x=y(2*(1-A(H.resonance,0.25)),y(2,2/u-u*0.5))}H.pushSample=function(I){if(F!==H.cutoff||w!==H.resonance){C();F=H.cutoff;w=H.resonance}B[3]=I-x*B[2];B[0]=B[0]+u*B[2];B[1]=B[3]-B[0];B[2]=u*B[1]+B[2];B[3]=I-x*B[2];B[0]=B[0]+u*B[2];B[1]=B[3]-B[0];B[2]=u*B[1]+B[2];return B[H.type]};H.getMix=function(I){return B[I||H.type]}}function a(w,x,y){var u=this,v=[0,0];u.cutoff=!x?20000:x;u.resonance=!y?0:y;u.samplerate=w;u.pushSample=function(A){var z=u.cutoff*2/u.samplerate,B=u.resonance+u.resonance/(1-z);v[0]=v[0]+z*(A-v[0]+B*(v[0]-v[1]));v[1]=v[1]+z*(v[0]-v[1]);return v[1]};u.getMix=function(){return v[1]}}function o(A,x,H){var I=this,F=0,z=0,C=h.PI*2,E,v,u,D,G,y;I.cutoff=!x?20000:x;I.resonance=!H?1:H;I.samplerate=A;function B(){E=C*I.cutoff/I.samplerate;v=1-E/(2*(I.resonance+0.5/(1+E))+E-2);u=v*v;D=u+1-2*h.cos(E)*v}I.pushSample=function(w){if(G!==I.cutoff||y!==I.resonance){B();G=I.cutoff;y=I.resonance}F+=(w-z)*D;z+=F;F*=u;return z};I.getMix=function(){return z};B()}function c(x,A){var v=0,z=0,w=h.PI*2,u=new b(1),y;this.frequency=440;if(A){this.frequency=A}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=x;this.generate=function(){var E=this.frequency+0,D=this.pulseWidth,C,B=arguments.length;for(C=0;C<B;C++){E+=E*arguments[C]}v=(v+E/this.samplerate/2)%1;z=(v+this.phaseOffset)%1;z=z<D?z/D:(z-D)/(1-D)};this.getMix=function(){return y[this.waveShape]()};this.getPhase=function(){return z};this.reset=function(){v=0};this.setWavetable=function(B){u=B;return true};this.sine=function(){return h.sin(z*w)};this.triangle=function(){if(z<0.5){return 4*z-1}return 3-4*z};this.square=function(){return(z<0.5)?-1:1};this.sawtooth=function(){return 1-z*2};this.invSawtooth=function(){return z*2-1};this.pulse=function(){if(z<0.5){if(z<0.25){return z*8-1}else{return 1-(z-0.25)*8}}return -1};this.wavetable=function(){return u[h.floor(z*u.length)]};y=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}function d(w,y,z){var v=this,u=[],x;v.sampleRate=w;v.sample=y;v.pitch=z||440;v.delayStart=0;v.delayEnd=0;v.maxVoices=0;v.noteOn=function(E){E=E||v.pitch;var D=E/v.pitch,C=v.sampleRate,F=C*v.delayStart,A=v.sample.length-C*v.delayEnd,B={f:E,p:F,s:D,l:A};u.push(B);return B};v.generate=function(){var A,B;for(A=0;A<u.length;A++){B=u[A];B.p+=B.s;B.p>B.l&&u.splice(A--,1)&&B.onend&&B.onend()}};v.getMix=function(){var B=0,A;for(A=0;A<u.length;A++){B+=d.interpolate(v.sample,u[A].p)}return B}}d.interpolate=function(u,y){var x=h.floor(y),w=x+1,v=y-x;w=w<u.length?w:0;return u[x]*(1-v)+u[w]*v};d.resample=function(A,u,D,E,w){var y=E/u*w/D,z=A.length,v=h.ceil(z/y),C=new b(v),B,x;for(B=0,x=0;B<z;B+=y){C[x++]=d.interpolate(A,B)}return C};(function(u){function A(I){var K,J=I.length,H={};for(K=0;K<J;K++){H[I[K]]=true}return H}function B(H,I){return I?G(H&255)+B(H>>8,I-1):""}var E=A([256,512,1024,2048,4096,8192,16384]),v=A([48000,44100,22050]),G=String.fromCharCode;function F(M,L,K,J){var I=F.devices,H;for(H in I){if(I.hasOwnProperty(H)&&I[H].enabled){try{return new I[H](M,L,K,J)}catch(N){}}}throw"No audio device available."}function x(R,J,O,W){J=J||44100;O=O||1;W=W||1;var P=W*8,L=O*W,X=J*L,M=R.length,K=M*W,H=(h.pow(2,P)-1)/2,V=W===2?32760:H,N,U,S,T,Y="",Q="";function I(Z){return B(h.floor(H+Z*V),W)}Y="RIFF"+B(36+K,4)+"WAVEfmt "+B(16,4)+B(1,2)+B(O,2)+B(J,4)+B(X,4)+B(L,2)+B(P,2)+"data"+B(K,4);for(U=0;U<M;U++){Y+=I(R[U])}return Y}function w(H){this.boundTo=H;this.buffers=[];H.activeRecordings.push(this)}w.prototype={toWav:function(H){return x(this.join(),this.boundTo.sampleRate,this.boundTo.channelCount,H)},add:function(H){this.buffers.push(H)},clear:function(){this.buffers=[]},stop:function(){var H=this.boundTo.activeRecordings,I;for(I=0;I<H.length;I++){if(H[I]===this){H.splice(I--,1)}}},join:function(){var L=0,M=0,J=this.buffers,H,N,K,I=J.length;for(K=0;K<I;K++){L+=J[K].length}H=new b(L);for(K=0;K<I;K++){for(N=0;N<J[K].length;N++){H[M+N]=J[K][N]}M+=J[K].length}return H}};function D(H){this.type=H}D.prototype={record:function(){return new w(this)},recordData:function(I){var K=this.activeRecordings,J,H=K.length;for(J=0;J<H;J++){K[J].add(I)}},writeBuffers:function(J){var I=this.buffers,H=J.length,K,M,L,N;if(I){for(L=0;L<I.length;L++){K=I[L];M=K.length;for(N=0;N<H&&N<M;N++){J[N]+=K[N]}I[L]=K.subarray(N);L>=M&&I.splice(L--,1)}}},writeBuffer:function(I){var H=this.buffers=this.buffers||[];H.push(I);return H.length}};function C(N,L,I,P){P=v[P]?P:44100;I=E[I]?I:P/2;var Q=this,K=0,O=null,M=new Audio(),H;function J(){var R,U,T,S;if(O){R=M.mozWriteAudio(O);K+=R;if(R<O.length){O=O.subarray(R);return O}O=null}U=M.mozCurrentSampleOffset();T=Number(U+I*L-K)+0;if(T>0){S=new b(T);N&&N(S,Q.channelCount);Q.writeBuffers(S);Q.recordData(S);R=M.mozWriteAudio(S);if(R<S.length){O=S.subarray(R)}K+=R}}M.mozSetup(L,P);H=setInterval(J,20);this.kill=function(){clearInterval(H)};this.activeRecordings=[];this.sampleRate=P;this.channelCount=L;this.type="moz"}C.enabled=true;C.prototype=new D("moz");function z(M,L,I,O){O=v[O]?O:44100;I=E[I]?I:4096;var P=this,H=new (window.AudioContext||webkitAudioContext)(),K=H.createJavaScriptNode(I,0,L),N=H.createBufferSource();function J(X){var Q=X.outputBuffer,T=Q.numberOfChannels,V,S,U=Q.length,Y=Q.size,W=new Array(T),R=new b(U*T);for(V=0;V<T;V++){W[V]=Q.getChannelData(V)}M&&M(R,T);P.writeBuffers(R);P.recordData(R);for(V=0;V<U;V++){for(S=0;S<T;S++){W[S][V]=R[V*T+S]}}}K.onaudioprocess=J;N.connect(K);K.connect(H.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=H.sampleRate;this.channelCount=L;this.type="webkit"}z.enabled=true;z.prototype=new D("webkit");function y(M,L,K,J){J=v[J]?J:44100;K=E[K]?bufferSize:8192;var H=this,N;function I(){var O=new b(K*L);M&&M(O,H.channelCount);H.writeBuffers(O);H.recordData(O)}this.kill=function(){clearInterval(N)};this.activeRecordings=[];setInterval(I,K/J*1000);this.sampleRate=J;this.channelCount=L;this.type="dummy"}y.enabled=true;y.prototype=new D("dummy");F.arrayToWav=x;F.integerToString=B;F.deviceClass=D;F.propertyEnum=A;F.devices={moz:C,webkit:z,dummy:y};u.AudioDevice=F}(this));this.AudioDevice.createScheduled=function(y){var x=[],u=0,v;function w(A,D){var z=A.length/D,G=v.chunkSize,C=G*D,F,B,E;u=+new Date;for(B=0;B<z;B+=G){for(F=0;F<x.length;F++){x[F].t-=G;if(x[F].t<=0){x[F].f.apply(x[F].x,x[F].a);x.splice(F--,1)}}E=B*C;y(A.subarray(E,E+C),D)}}v=this.apply(this,[w].concat(Array.prototype.splice.call(arguments,1)));v.schedule=function(B,A,z){x.push({f:B,x:A,a:z,t:((new Date-u)*0.001*this.sampleRate)})};v.chunkSize=1;return v};(function(v,w){var C=w.sin,G=w.cos,F=w.sqrt,A=w.floor,B=w.pow,u=w.ln2,z=w.PI,y=z*2;function x(I,H,J){I.sampleRate=H;I.bufferSize=J;I.bandWidth=0.5*J*H*0.5;I.spectrum=new b(J*0.5);I.real=new b(J);I.imag=new b(J);I.peakBand=I.peak=0;I.getBandFrequency=function(K){return this.bandwidth*K+this.bandwidth*0.5};I.calculateSpectrum=function(){var V=this,R=V.spectrum,S=V.real,K=V.imag,U=0.5*V.bufferSize,L=F,Q=J*0.5,P,T,O,M;for(M=0;M<Q;M++){P=S[M];T=K[M];O=U*L(P*P+T*T);if(O>V.peak){V.peakBand=M;V.peak=O}}}}function E(I,H,J){return new E[I](H,J)}function D(I,O){var H=this,L=O*O*0.5,K=new b(L),M=new b(L),J;x(H,I,O);for(J=0;J<L;J++){K[J]=C(J*y/O);M[J]=G(J*y/O)}H.forward=function(T){var Y=this,W=Y.real,P=Y.imag,V=Y.bufferSize*0.5,R=T.length,U,X,S,Q,Z;for(S=0;S<V;S++){U=X=0;for(Q=0;Q<R;Q++){U+=M[Z=S*Q]*T[Q];X+=K[Z]*T[Q]}W[S]=U;P[S]=X}return Y.calculateSpectrum()}}v.FourierTransform=E;E.DFT=D}(this,h));e.ADSREnvelope=s;e.MidiEventTracker=t;e.StepSequencer=r;e.AllPassFilter=m;e.Chorus=p;e.Delay=f;e.Distortion=k;e.IIRFilter=g;e.LowPassFilter=a;e.LP12Filter=o;e.Oscillator=c;e.Sampler=d;function l(){var u=Array.prototype.splice.call(arguments,0),v=u.prototype=l.prototype;for(i in v){if(v.hasOwnProperty(i)){u[i]=v[i]}}return u}(function(u){l.prototype=u;u.pushSample=function(y){var v=this,x,w;for(w=0;w<v.length;w++){x=v[w].mix;y=v[w].pushSample(y)*x+y*(1-x)}return y}}({}));function j(){}j.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return l.apply(0,[this].concat(Array.prototype.splice.call(arguments,0)))}};(function(y,v,x,u,w){x=e.effects={};for(v=0;v<y.length;v++){u=y[v];x[u]=e[u];w=x[u].prototype=new j();w.name=w.fxid=u}}(["AllPassFilter","Chorus","Delay","Distortion","IIRFilter","LowPassFilter","LP12Filter"]));e.EffectChain=l;e.EffectClass=j;e.version="0.4.2";return e}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);