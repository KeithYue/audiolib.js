this.audioLib=(function(o,f){var d=o.Float32Array||Array,l=this;function c(q){var r=new d(q);r.subarray=r.subarray||r.slice;return r}function e(w,r,t,x,v){this.attack=r||50;this.decay=t||50;this.sustain=x||1;this.release=v||50;this.value=0;var y=this,q=3,s=false,u=[function(){y.value+=1000/y.sampleRate/y.attack;if(y.value>=1){q=1}},function(){y.value-=1000/y.sampleRate/y.decay*y.sustain;if(y.value<=y.sustain){q=2}},function(){y.value=y.sustain},function(){y.value=f.max(0,y.value-1000/y.sampleRate/y.release)}];this.generate=function(){u[q]();return this.value};this.triggerGate=function(z){s=z;q=s?0:3};this.sampleRate=w}function n(){var x=this,q=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function w(z,A){this.key=z;this.velocity=A;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(C,B){this.key=C;this.v=B;this.onKeyChange()};this.getFrequency=function(){return x.getFrequencyForKey(this.key)};x.voice.apply(this)}function t(A){var z;for(z=0;z<q.length;z++){if(q[z].key===A){q.splice(z--,1)}}}function y(z,A){t(z);q.push({key:z,velocity:A})}function v(){var z,B,A=[];if(x.legato===0){A=q.slice(0)}else{if(x.legato===1){for(z=0;z<q.length;z++){for(B=0;B<A.length;B++){if(B===q.length-1||(A[B-1].key>q[z].key&&A[B].key<q[z].key)){A.splice(B,0,q[z]);break}}}}else{if(x.legato===2){for(z=0;z<q.length;z++){for(B=0;B<A.length;B++){if(B===q.length-1||(A[B-1].key<q[z].key&&A[B].key>q[z].key)){A.splice(B,0,q[z]);break}}}}}}x.activeKeys=A.slice(-x.polyphony)}function r(){if(!x.voice){return}var A,B,z;if(x.polyphony===1&&x.activeKeys.length>0){A=x.activeKeys.length-1;if(x.voices.length===0){x.voices.push(new w(x.activeKeys[A].key,x.activeKeys[A].velocity))}else{x.voices[0].changeKey(x.activeKeys[A].key,x.activeKeys[A].velocity)}}else{for(B=0;B<x.activeKeys.length;B++){z=false;for(A=0;A<x.voices.length;A++){if(x.voices[A].key===x.activeKeys[B].key){z=true;break}}if(!z){x.voices.push(new w(x.activeKeys[A].key,x.activeKeys[A].velocity))}}}for(A=0;A<x.voices.length;A++){z=false;for(B=0;B<x.activeKeys.length;B++){if(x.voices[A].key===x.activeKeys[B].key){z=true;break}}if(!z){x.voices[A].noteOff();x.voices.splice(A--,1)}}}function s(A,B){var z=x.activeKeys.length;y(A,B);v();r();x.onNoteOn(A,B);if(x.retrigger===0||(z===0&&x.activeKeys.length>0)){x.onTrigger()}}function u(z,A){t(z,A);v();r();x.onNoteOff(z,A);if(x.activeKeys===0){x.onRelease()}}this.onMidi=function(z){switch(z.status){case 9:s(z.data1,z.data2/127);break;case 8:u(z.data1,z.data2/127);break;case 14:x.pitchBend=(z.data1*128+z.data2-8192)/8192;break}};this.getFrequencyForKey=function(z){return 440*f.pow(1.059,z-69)};this.getFrequency=function(){var A=[],z;for(z=0;z<x.activeKeys.length;z++){A.push(x.getFrequencyForKey(x.activeKeys[z].key))}if(A.length>2){return A[0]}return A};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(z){x.onMidi(z)}}function p(t,u,s,v){var r=this,q=0;r.sampleRate=t;r.stepLength=u||200;r.steps=s||[1,0];r.value=0;r.attack=v||0;r.generate=function(){var C=r.sampleRate/1000*r.stepLength,x=r.steps,z=C*x.length,B,w,A,y,D;if(++q===z){q=0}B=q/z*x.length;w=B%1;B=f.floor(B);A=(B||x.length)-1;y=x[B]-x[A];D=x[B];if(w<r.attack){D-=y-y/r.attack*w}r.value=D;return D};r.triggerGate=function(){q=0}}function b(x,q,u,r){var z=this,s=new c(q),t=q-1,v=u,w=0,y=0;this.volume=z.volume||1;z.sampleRate=x;z.pushSample=function(A){s[v++]=A;y=s[w++]*z.volume;if(v>=t){v=0}if(w>=t){w=0}return y};z.getMix=function(){return y}}function m(w,s,v,r){var y=this,t,u,x;y.delayTime=s||30;y.depth=v||3;y.freq=r||0.1;function q(){t=new c(y.sampleRate*0.1);u=0;var A,z=t.length;for(A=0;A<z;A++){t[A]=0}}y.sampleRate=w;y.osc=new g(w,r);y.calcCoeff=q;y.pushSample=function(A){if(++u>=t.length){u=0}t[u]=A;y.osc.generate();var z=y.delayTime+y.osc.getMix()*y.depth;z*=y.sampleRate/1000;z=u-f.floor(z);while(z<0){z+=t.length}x=t[z];return x};y.getMix=function(){return x};q()}function k(y,v,B){var E=this,t=(!y?44100:y)*2,w=new c(t),x=0,u=0,A=0,D=0,z=f.floor;function s(){u=t/E.samplerate/E.time*1000;A=E.time}function C(F,I,H){var G=I;while(G++!==H){if(G>=t){G=0}w[G]=F}}function r(F){w[x++]+=F;if(x>E.time/1000*E.samplerate){x=0}w[x]=w[x]*E.feedback}function q(G){var F=z(x);if(A!==E.time){s()}x+=u;if(x>=t){x-=t}C(G+w[z(x)]*E.feedback,F,z(x))}this.time=!v?1000:v;this.feedback=0;this.algorithm=0;this.samplerate=y;this.pushSample=function(F){if(this.algorithm===0){r(F)}else{q(F)}D=w[z(x)];return D};this.getMix=function(){return D}}function a(q){var u=new i(q,720.484),t=new i(q,723.431),s=new i(q,1),r=0;this.gain=4;this.master=1;this.sampleRate=q;this.filters=[u,t,s];this.pushSample=function(v){u.pushSample(v);r=u.getMix(1)*this.gain;r=f.atan(r)+r;if(r>0.4){r=0.4}else{if(r<-0.4){r=-0.4}}t.pushSample(r);s.pushSample(t.getMix(0));r=s.getMix(1)*this.master;return r};this.getMix=function(){return r}}(function(q,r){r.Capper=function(u,v){var t=this,s=0;t.sampleRate=u;t.cap=v||1;t.pushSample=function(w){s=w>t.cap?2*t.cap-w:w<-t.cap?-2*t.cap-w:w;return s};t.getMix=function(){return s}};r.Expo=function(t,u){var s=this;sample=0;s.sampleRate=t;s.param=u||0.8;s.pushSample=function(v){sample=(v<0?-f.pow(s.param*2,-v):f.pow(s.param*2,v))/10;return sample};s.getMix=function(){return sample}}}(this,l));function i(u,x,B,A){var D=this,y=[0,0,0,0],r,s,C,v,z=f.sin,t=f.min,w=f.pow;D.cutoff=!x?20000:x;D.resonance=!B?0.1:B;D.samplerate=u;D.type=A||0;function q(){r=2*z(f.PI*t(0.25,D.cutoff/(D.samplerate*2)));s=t(2*(1-w(D.resonance,0.25)),t(2,2/r-r*0.5))}D.pushSample=function(E){if(C!==D.cutoff||v!==D.resonance){q();C=D.cutoff;v=D.resonance}y[3]=E-s*y[2];y[0]=y[0]+r*y[2];y[1]=y[3]-y[0];y[2]=r*y[1]+y[2];y[3]=E-s*y[2];y[0]=y[0]+r*y[2];y[1]=y[3]-y[0];y[2]=r*y[1]+y[2];return y[D.type]};D.getMix=function(E){return y[E||D.type]}}function h(s,t,u){var q=this,r=[0,0];q.cutoff=!t?20000:t;q.resonance=!u?0:u;q.samplerate=s;q.pushSample=function(w){var v=q.cutoff*2/q.samplerate,x=q.resonance+q.resonance/(1-v);r[0]=r[0]+v*(w-r[0]+x*(r[0]-r[1]));r[1]=r[1]+v*(r[0]-r[1]);return r[1]};q.getMix=function(){return r[1]}}function j(x,z,C){var G=this,F=0,v=0,A=f.PI*2,E,u,s,B,D,y;G.cutoff=!z?20000:z;G.resonance=!C?1:C;G.samplerate=x;function t(){E=A*G.cutoff/G.samplerate;u=1-E/(2*(G.resonance+0.5/(1+E))+E-2);s=u*u;B=s+1-2*f.cos(E)*u}G.pushSample=function(q){if(D!==G.cutoff||y!==G.resonance){t();D=G.cutoff;y=G.resonance}F+=(q-v)*B;v+=F;F*=s;return v};G.getMix=function(){return v};t()}function g(t,w){var r=0,v=0,s=f.PI*2,q=new c(1),u;this.frequency=440;if(w){this.frequency=w}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=t;this.generate=function(){var A=this.frequency+0,z=this.pulseWidth,y,x=arguments.length;for(y=0;y<x;y++){A+=A*arguments[y]}r=(r+A/this.samplerate/2)%1;v=(r+this.phaseOffset)%1;v=v<z?v/z:(v-z)/(1-z)};this.getMix=function(){return u[this.waveShape]()};this.getPhase=function(){return v};this.reset=function(){r=0};this.setWavetable=function(x){q=x;return true};this.sine=function(){return f.sin(v*s)};this.triangle=function(){if(v<0.5){return 4*v-1}return 3-4*v};this.square=function(){return(v<0.5)?-1:1};this.sawtooth=function(){return 1-v*2};this.invSawtooth=function(){return v*2-1};this.pulse=function(){if(v<0.5){if(v<0.25){return v*8-1}else{return 1-(v-0.25)*8}}return -1};this.wavetable=function(){return q[f.floor(v*q.length)]};u=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}(function(x){function r(C){var E,D=C.length,F={};for(E=0;E<D;E++){F[C[E]]=true}return F}var z=r([256,512,1024,2048,4096,8192,16384]),s=r([48000,44100,22050]),A=String.fromCharCode;function B(F,H,D,K){K=s[K]?K:44100;D=z[D]?bufferSize:K/2;var L=this,I=0,J=null,G=new Audio(),C;function E(){var O,N,M,P;if(J){O=G.mozWriteAudio(J);I+=O;if(O<J.length){J=J.subarray(O);return J}J=null}N=G.mozCurrentSampleOffset();M=Number(N+D*H-I)+0;if(M>0){P=new c(M);F(P,L.channelCount);L.recordData(P);O=G.mozWriteAudio(P);if(O<P.length){J=P.subarray(O)}I+=O}}G.mozSetup(H,K);C=setInterval(E,20);this.kill=function(){clearInterval(C)};this.activeRecordings=[];this.sampleRate=K;this.channelCount=H;this.type="moz"}function u(H,I,C,J){J=s[J]?J:44100;C=z[C]?bufferSize:4096;var K=this,D=new (x.AudioContext||x.webkitAudioContext)(),G=D.createJavaScriptNode(C,0,I),F=D.createBufferSource();function E(S){var R=S.outputBuffer,P=R.numberOfChannels,N,L,M=R.length,T=R.size,O=new Array(P),Q=new c(M*P);for(N=0;N<P;N++){O[N]=R.getChannelData(N)}H(Q,P);K.recordData(Q);for(N=0;N<M;N++){for(L=0;L<P;L++){O[L][N]=Q[N*P+L]}}}G.onaudioprocess=E;F.connect(G);G.connect(D.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=D.sampleRate;this.channelCount=I;this.type="webkit"}function t(I,D,G,F){F=s[F]?F:44100;G=z[G]?bufferSize:8192;var C=this,H;function E(){var J=new c(G*D);I(J,C.channelCount);C.recordData(J)}this.kill=function(){clearInterval(H)};this.activeRecordings=[];setInterval(E,G/F*1000);this.sampleRate=F;this.channelCount=D;this.type="dummy"}function y(H,C,E,D){try{return new B(D,C,H,E)}catch(G){}try{return new u(D,C,H,E)}catch(F){}if(y.dummy){return new t(D,C,H,E)}throw"No audio device available."}function q(C,D){return D?A(C&255)+q(C>>8,D-1):""}function v(L,D,E,Q){D=D||44100;E=E||1;Q=Q||1;var J=Q*8,G=E*Q,O=D*G,I=L.length,F=I*Q,M=(f.pow(2,J)-1)/2,R=Q===2?32760:M,H,S,N,P,T="",K="";function C(U){return q(f.floor(M+U*R),Q)}T="RIFF"+q(36+F,4)+"WAVEfmt "+q(16,4)+q(1,2)+q(E,2)+q(D,4)+q(O,4)+q(G,2)+q(J,2)+"data"+q(F,4);for(S=0;S<I;S++){T+=C(L[S])}return T}function w(C){this.boundTo=C;this.buffers=[];C.activeRecordings.push(this)}w.prototype={toWav:function(C){return v(this.join(),this.boundTo.sampleRate,this.boundTo.channelCount,C)},add:function(C){this.buffers.push(C)},clear:function(){this.buffers=[]},stop:function(){var C=this.boundTo.activeRecordings,D;for(D=0;D<C.length;D++){if(C[D]===this){C.splice(D--,1)}}},join:function(){var G=0,H=0,E=this.buffers,C,I,F,D=E.length;for(F=0;F<D;F++){G+=E[F].length}C=new c(G);for(F=0;F<D;F++){for(I=0;I<E[F].length;I++){C[H+I]=E[F][I]}H+=E[F].length}return C}};B.prototype=u.prototype=t.prototype={record:function(){return new w(this)},recordData:function(E){var F=this.activeRecordings,D,C=F.length;for(D=0;D<C;D++){F[D].add(E)}}};y.dummy=false;y.arrayToWav=v;y.integerToString=q;y.createDummy=function(D,C,F,E){return new t(D,C,F,E)};x.AudioDevice=y}(this));this.AudioDevice.createScheduled(function(t){var u=[],s=0,q;function r(y,w){var v=y.length/w,z,x;s=+new Date;for(x=0;x<v;x++){for(z=0;z<u.length;z++){if(u[z].t--<=0){u[z].f.apply(u[z].x,u[z].a);u.splice(z--,1)}}t(y.subarray(x*w,w),w)}}q=this.apply(this,[r].concat(Array.prototype.splice.call(arguments,1)));q.schedule=function(x,w,v){u.push({f:x,x:w,a:v,t:((new Date-s)*0.001*this.sampleRate)})}});(function(x,r){var y=r.sin,C=r.cos,B=r.sqrt,v=r.floor,w=r.pow,q=r.ln2,u=r.PI,t=u*2;function s(E,D,F){E.sampleRate=D;E.bufferSize=F;E.bandWidth=0.5*F*D*0.5;E.spectrum=new c(F*0.5);E.real=new c(F);E.imag=new c(F);E.peakBand=E.peak=0;E.getBandFrequency=function(G){return this.bandwidth*G+this.bandwidth*0.5};E.calculateSpectrum=function(){var R=this,G=R.spectrum,O=R.real,I=R.imag,Q=0.5*R.bufferSize,H=B,M=F*0.5,L,P,K,J;for(J=0;J<M;J++){L=O[J];P=I[J];K=Q*H(L*L+P*P);if(K>R.peak){R.peakBand=J;R.peak=K}}}}function A(E,D,F){return new A[E](D,F)}function z(E,J){var D=this,I=J*J*0.5,G=new c(I),H=new c(I),F;s(D,E,J);for(F=0;F<I;F++){G[F]=y(F*t/J);H[F]=C(F*t/J)}D.forward=function(P){var U=this,S=U.real,K=U.imag,R=U.bufferSize*0.5,M=P.length,Q,T,O,L,V;for(O=0;O<R;O++){Q=T=0;for(L=0;L<M;L++){Q+=H[V=O*L]*P[L];T+=G[V]*P[L]}S[O]=Q;K[O]=T}return U.calculateSpectrum()}}x.FourierTransform=A;A.DFT=z}(this,f));l.ADSREnvelope=e;l.MidiEventTracker=n;l.StepSequencer=p;l.AllPassFilter=b;l.Chorus=m;l.Delay=k;l.Distortion=a;l.IIRFilter=i;l.LowPassFilter=h;l.LP12Filter=j;l.Oscillator=g;l.version="0.4.0";return l}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);